# ==========================
# Toolchain
# ==========================

CC = gcc
RM = del
CFLAGS = -g -Wall -Wfatal-errors -DSEP_LOGGING_ENABLED
LDFLAGS = 

# ==========================
# File lists
# ==========================

OBJECTS = common/errors.o common/debugging.o common/garray.o \
  vm/module.o vm/mem.o vm/types.o vm/objects.o vm/arrays.o vm/functions.o vm/vm.o \
  vm/code.o vm/exceptions.o vm/stack.o \
  io/decoder.o \
  runtime/runtime.o runtime/stringp.o runtime/objectp.o runtime/support.o \
  runtime/integerp.o runtime/specialp.o runtime/exceptionsp.o \
  september.o

OBJECTS_WIN = $(subst /,\,$(OBJECTS))
SOURCES = $(subst .o,.c,$(OBJECTS))
DEPS = $(subst .o,.d,$(OBJECTS))
DEPS_WIN = $(subst /,\,$(DEPS))

# ==========================
# Executables
# ==========================

OUT = 09.exe

$(OUT): $(OBJECTS)
	$(CC) $(OBJECTS) $(LDFLAGS) -o$(OUT)

# clean does not need dependencies
ifneq ($(MAKECMDGOALS),clean)
    -include $(DEPS)
endif

# ==========================
# Phony targets
# ==========================

.PHONY: clean deps all

all: $(DEPS) $(OUT)	
	
deps: $(DEPS)
	
clean:
	$(RM) $(OUT) $(OBJECTS_WIN) $(DEPS_WIN)

# ==========================
# Autogenerated dependencies
# ==========================

# how to make a .d file
%.d: %.c
	$(CC) -MM $< -MT $(<:.c=.o) >$@


